<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link href="/css/output.css" rel="stylesheet">
    <script src="/js/auth.js"></script>
</head>

<body class="bg-primary-grey-75 min-h-screen">
    <nav class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-semibold text-primary-graphite-300">My Profile</h1>
                </div>
                <div class="flex items-center">
                    <a href="#" id="logout-btn"
                        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-secondary-orange-normal hover:bg-secondary-orange-normal-hover">
                        Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Profile Header with Avatar Section -->
        <% if (userProfile && userProfile.picture) { %>
            <div class="bg-white shadow rounded-lg p-6 mb-6">
                <div class="flex flex-col md:flex-row items-center">
                    <div class="w-24 h-24 rounded-full overflow-hidden mb-4 md:mb-0 md:mr-6">
                        <img src="<%= userProfile.picture %>" alt="Profile photo of the user"
                            class="w-full h-full object-cover">
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-primary-graphite-300">
                            <%= userProfile.name %>
                        </h2>
                        <p class="text-primary-graphite-100">
                            <%= userProfile.email %>
                        </p>
                        <% if (userProfile.emailVerified) { %>
                            <span
                                class="inline-flex items-center mt-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-green-400" fill="currentColor"
                                    viewBox="0 0 8 8">
                                    <circle cx="4" cy="4" r="3" />
                                </svg>
                                Verified
                            </span>
                            <% } %>
                    </div>
                </div>
            </div>
            <% } %>

                <!-- Basic Profile Information Section -->
                <div class="bg-white shadow rounded-lg p-6 mb-6">
                    <div class="px-4 sm:px-0">
                        <h3 class="text-lg font-medium leading-6 text-primary-graphite-300 mb-4">Basic Information</h3>
                    </div>

                    <div class="border-t border-primary-grey-200">
                        <dl>
                            <div class="bg-primary-grey-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-primary-graphite-100">Full name</dt>
                                <dd class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                    <%= userProfile ? userProfile.name : user.name %>
                                </dd>
                            </div>

                            <% if (userProfile && (userProfile.givenName || userProfile.familyName)) { %>
                                <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                    <dt class="text-sm font-medium text-primary-graphite-100">Name components</dt>
                                    <dd class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                        <% if (userProfile.givenName) { %>Given name: <%= userProfile.givenName %><br>
                                                <% } %>
                                                    <% if (userProfile.middleName) { %>Middle name: <%=
                                                            userProfile.middleName %><br>
                                                            <% } %>
                                                                <% if (userProfile.familyName) { %>Family name: <%=
                                                                        userProfile.familyName %>
                                                                        <% } %>
                                    </dd>
                                </div>
                                <% } %>

                                    <div class="bg-primary-grey-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                        <dt class="text-sm font-medium text-primary-graphite-100">Email address</dt>
                                        <dd class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                            <%= userProfile ? userProfile.email : user.email %>
                                                <% if (userProfile && userProfile.emailVerified) { %>
                                                    <span
                                                        class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                        Verified
                                                    </span>
                                                    <% } %>
                                        </dd>
                                    </div>

                                    <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                        <dt class="text-sm font-medium text-primary-graphite-100">User ID</dt>
                                        <dd class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                            <%= userProfile ? userProfile.id : user.id %>
                                        </dd>
                                    </div>

                                    <div class="bg-primary-grey-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                        <dt class="text-sm font-medium text-primary-graphite-100">Username</dt>
                                        <dd class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                            <%= userProfile ? userProfile.username : user.username %>
                                        </dd>
                                    </div>

                                    <% if (userProfile && userProfile.phoneNumber) { %>
                                        <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                            <dt class="text-sm font-medium text-primary-graphite-100">Phone number</dt>
                                            <dd class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                                <%= userProfile.phoneNumber %>
                                                    <% if (userProfile.phoneVerified) { %>
                                                        <span
                                                            class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                            Verified
                                                        </span>
                                                        <% } %>
                                            </dd>
                                        </div>
                                        <% } %>
                        </dl>
                    </div>
                </div>

                <% if (userProfile && (userProfile.locale || userProfile.zoneinfo)) { %>
                    <!-- Additional Information Section -->
                    <div class="bg-white shadow rounded-lg p-6 mb-6">
                        <div class="px-4 sm:px-0">
                            <h3 class="text-lg font-medium leading-6 text-primary-graphite-300 mb-4">Additional
                                Information</h3>
                        </div>

                        <div class="border-t border-primary-grey-200">
                            <dl>
                                <% if (userProfile.locale) { %>
                                    <div class="bg-primary-grey-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                        <dt class="text-sm font-medium text-primary-graphite-100">Locale</dt>
                                        <dd class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                            <%= userProfile.locale %>
                                        </dd>
                                    </div>
                                    <% } %>

                                        <% if (userProfile.zoneinfo) { %>
                                            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                                <dt class="text-sm font-medium text-primary-graphite-100">Time zone</dt>
                                                <dd
                                                    class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                                    <%= userProfile.zoneinfo %>
                                                </dd>
                                            </div>
                                            <% } %>
                            </dl>
                        </div>
                    </div>
                    <% } %>

                        <% if (userProfile && (userProfile.groups || userProfile.roles || userProfile.permissions)) { %>
                            <!-- Authorization Information -->
                            <div class="bg-white shadow rounded-lg p-6 mb-6">
                                <div class="px-4 sm:px-0">
                                    <h3 class="text-lg font-medium leading-6 text-primary-graphite-300 mb-4">
                                        Authorization Information</h3>
                                </div>

                                <div class="border-t border-primary-grey-200">
                                    <dl>
                                        <% if (userProfile.groups && userProfile.groups.length> 0) { %>
                                            <div
                                                class="bg-primary-grey-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                                <dt class="text-sm font-medium text-primary-graphite-100">Groups</dt>
                                                <dd
                                                    class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                                    <% userProfile.groups.forEach(function(group) { %>
                                                        <span
                                                            class="inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium bg-blue-100 text-blue-800 mr-2 mb-2">
                                                            <%= group %>
                                                        </span>
                                                        <% }); %>
                                                </dd>
                                            </div>
                                            <% } %>

                                                <% if (userProfile.roles && userProfile.roles.length> 0) { %>
                                                    <div
                                                        class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                                        <dt class="text-sm font-medium text-primary-graphite-100">Roles
                                                        </dt>
                                                        <dd
                                                            class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                                            <% userProfile.roles.forEach(function(role) { %>
                                                                <span
                                                                    class="inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium bg-purple-100 text-purple-800 mr-2 mb-2">
                                                                    <%= role %>
                                                                </span>
                                                                <% }); %>
                                                        </dd>
                                                    </div>
                                                    <% } %>

                                                        <% if (userProfile.permissions &&
                                                            userProfile.permissions.length> 0) { %>
                                                            <div
                                                                class="bg-primary-grey-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                                                <dt
                                                                    class="text-sm font-medium text-primary-graphite-100">
                                                                    Permissions</dt>
                                                                <dd
                                                                    class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                                                    <% userProfile.permissions.forEach(function(permission)
                                                                        { %>
                                                                        <span
                                                                            class="inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium bg-green-100 text-green-800 mr-2 mb-2">
                                                                            <%= permission %>
                                                                        </span>
                                                                        <% }); %>
                                                                </dd>
                                                            </div>
                                                            <% } %>
                                    </dl>
                                </div>
                            </div>
                            <% } %>

                                <!-- Token Information Section -->
                                <div class="bg-white shadow rounded-lg p-6">
                                    <div class="px-4 sm:px-0">
                                        <h3 class="text-lg font-medium leading-6 text-primary-graphite-300 mb-4">Token
                                            Information</h3>
                                    </div>

                                    <% if (userProfile) { %>
                                        <div class="border-t border-primary-grey-200 mb-6">
                                            <dl>
                                                <div
                                                    class="bg-primary-grey-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                                    <dt class="text-sm font-medium text-primary-graphite-100">Issuer
                                                    </dt>
                                                    <dd
                                                        class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                                        <%= userProfile.issuer %>
                                                    </dd>
                                                </div>

                                                <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                                    <dt class="text-sm font-medium text-primary-graphite-100">Audience
                                                    </dt>
                                                    <dd
                                                        class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                                        <%= Array.isArray(userProfile.audience) ?
                                                            userProfile.audience.join(', ') : userProfile.audience %>
                                                    </dd>
                                                </div>

                                                <div
                                                    class="bg-primary-grey-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                                    <dt class="text-sm font-medium text-primary-graphite-100">Issued at
                                                    </dt>
                                                    <dd
                                                        class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                                        <%= userProfile.issuedAt %>
                                                    </dd>
                                                </div>

                                                <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                                    <dt class="text-sm font-medium text-primary-graphite-100">Expires at
                                                    </dt>
                                                    <dd
                                                        class="mt-1 text-sm text-primary-graphite-300 sm:mt-0 sm:col-span-2">
                                                        <%= userProfile.expiration %>
                                                    </dd>
                                                </div>
                                            </dl>
                                        </div>
                                        <% } %>

                                            <!-- Complete ID Token Payload Section -->
                                            <div class="px-4 sm:px-0 mb-4">
                                                <h4 class="text-base font-medium leading-6 text-primary-graphite-300">Complete Access Token Payload</h4>
                                                <p class="mt-1 text-sm text-primary-graphite-100">
                                                    This is the complete access token payload from your authentication provider.
                                                </p>
                                            </div>

                                            <div class="border-t border-primary-grey-200 p-4">
                                                <% if (idToken) { %>
                                                    <pre class="text-sm text-primary-graphite-300 bg-white p-3 rounded border overflow-auto max-h-[500px]"><code><%= JSON.stringify(idToken.payload || idToken, null, 2) %></code></pre>
                                                <% } else { %>
                                                    <p class="text-sm text-primary-graphite-100">No token information available</p>
                                                <% } %>
                                            </div>
                                </div>
    </main>

    <script>
        document.addEventListener(' DOMContentLoaded', function () {
            const
            logoutBtn = document.getElementById('logout-btn'); if
                (logoutBtn) {
                    logoutBtn.addEventListener('click', function
                        (e) {
                            e.preventDefault(); window.authManager.clearTokens();
                        window.location.href = '/logout';
                    });
            }
        }); </script>
</body>

</html>